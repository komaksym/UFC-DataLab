import scrapy 
from ..items import ScorecardImagesItem


class ScorecardsSpider(scrapy.Spider):
    name = "images_spider"
    allowed_domains = ["www.ufc.com", "cloudfront.net"]
    start_urls = ["https://www.ufc.com/scorecards"]

    def parse(self, response):
        event_links = response.xpath('//*[@id="block-mainpagecontent"]/div/div/div[3]/div/div/a/@href').getall()
        for event_link in event_links:
            yield scrapy.Request(url=f"https://www.ufc.com{event_link}", callback=self.parse_event)

        next_page_btn = response.xpath("//a[@title='Load more items']/@href").get()
        if next_page_btn is not None:
            next_page = response.urljoin(next_page_btn)
            yield scrapy.Request(url=next_page, callback=self.parse)

    def parse_event(self, response):
        scorecards_item = ScorecardImagesItem()
        scorecards_item['image_urls'] = response.xpath('//*[@id="block-mainpagecontent"]/div/div[2]/div/div/div[2]/div/div/div[1]/div/div/img/@src').getall()[::-1]
        yield scorecards_item


class BackupScorecardsSpider(scrapy.Spider):
    name = "backup_images_spider"
    allowed_domains = ["www.ufc.com", "cloudfront.net"]
    start_urls = ["https://www.ufc.com/news/official-judges-scorecards-ufc-fight-night-kattar-vs-chikadze-ufc-vegas-46", "https://www.ufc.com/news/official-judges-scorecards-ufc-fight-night-lewis-vs-daukaus-ufc-vegas-45", "https://www.ufc.com/news/official-judges-scorecards-ufc-269-oliveira-vs-poirier-nunes-pena", "https://www.ufc.com/news/official-judges-scorecards-ufc-fight-night-font-vs-aldo-ufc-vegas-44", "https://www.ufc.com/news/official-scorecards-ufc-fight-night-vieira-vs-tate-ufc-vegas-43", "https://www.ufc.com/news/official-scorecards-ufc-fight-night-holloway-vs-rodriguez-ufc-vegas-42", "https://www.ufc.com/news/official-scorecards-ufc-268-usman-vs-covington-2-namajunas-vs-zhang-msg", "https://www.ufc.com/news/official-scorecards-ufc-267-blachowicz-vs-teixeira-yan-vs-sandhagen-abu-dhabi", "https://www.ufc.com/news/official%20-scorecards-ufc-fight-night-costa-vs-vettori-ufc-vegas-41", "https://www.ufc.com/news/official-judges-scorecards-ufc-fight-night-ladd-vs-dumont-ufc-vegas-40", "https://www.ufc.com/news/official-scorecards-ufc-fight-night-dern-vs-rodriguez", "https://www.ufc.com/news/official-judges-scorecards-winners-ufc-fight-night-santos-vs-walker-ufc-vegas-38", "https://www.ufc.com/news/ufc-266-volkanovski-vs-ortega-shevchenko-murhpy-nick-diaz-lawler-official-judges-scorecards", "https://www.ufc.com/news/ufc-fight-night-smith-vs-spann-official-judges-scorecards-ufc-vegas-37", "https://www.ufc.com/news/ufc-fight-night-brunson-vs-till-official-judges-scorecards-ufc-vegas-36", "https://www.ufc.com/news/ufc-fight-night-barboza-vs-chikadze-tuf-29-finale-official-scorecards-ufc-vegas-35", "https://www.ufc.com/news/ufc-figh-night-cannonier-vs-gastelum-official-judges-scorecards-ufc-vegas-34", "https://www.ufc.com/news/official-scorecards-ufc-265-lewis-vs-gane", "https://www.ufc.com/news/ufc-fight-night-hall-vs-strickland-official-scorecards-judges-results-ufc-vegas-33", "https://www.ufc.com/news/official-scorecards-ufc-fight-night-sandhagen-vs-dillashaw", "https://www.ufc.com/news/official-scorecards-ufc-fight-night-makhachev-vs-moises", "https://www.ufc.com/news/official-scorecards-ufc-264-poirier-vs-mcgregor-3", "https://www.ufc.com/news/official-scorecards-ufc-fight-night-gane-vs-volkov", "https://www.ufc.com/news/official-scorecards-ufc-fight-night-korean-zombie-vs-ige", "https://www.ufc.com/news/ufc-263-adesanya-vettori-2-figueiredo-moreno-2-official-scorecards-results", "https://www.ufc.com/news/ufc-fight-night-rozenstruik-sakai-official-scorecards-results-ufc-vegas-28", "https://www.ufc.com/news/ufc-fight-night-font-vs-garbrandt-official-scorecards-results-ufc-vegas-27", "https://www.ufc.com/news/ufc-262-oliveira-vs-chandler-official-scorecards-results-ferguson-dariush-houston", "https://www.ufc.com/news/ufc-fight-night-rodriguez-vs-waterson-official-scorecards-results-ufc-vegas-26", "https://www.ufc.com/news/official-scorecards-ufc-fight-night-reyes-vs-prochazka-swanson-chikadze-ufc-vegas-25", "https://www.ufc.com/news/ufc-261-usman-vs-masvidal-2-official-scorecards-zhang-namajunas-shevchenko-andrade", "https://www.ufc.com/news/ufc-fight-night-whittaker-vs-gastelum-official-scorecards-stephens-klose-arlovski-sherman-espn-plus-ufc-vegas-24", "https://www.ufc.com/news/ufc-fight-night-vettori-vs-holland-official-scorecards-till-allen-yusuff-nunes-dern-abc-espn-plus-ufc-vegas-23", "https://www.ufc.com/news/ufc-260-miocic-vs-ngannou-2-official-scorecards-woodley-luque-omalley-almeida-ufc-apex-espn-plus", "https://www.ufc.com/news/ufc-fight-night-brunson-vs-holland-scorecards-gillespie-riddell-winners-ufc-vegas-22", "https://www.ufc.com/news/ufc-vegas-21-fight-night-edwards-vs-muhammad-official-scorecards-results", "https://www.ufc.com/news/ufc-259-official-scorecards-results-blachowicz-adesanya-nunes-anderson-yan-sterling", "https://www.ufc.com/news/ufc-fight-night-rozenstruik-vs-gane-official-scorecards-ufc-vegas-20", "https://www.ufc.com/news/ufc-fight-night-blaydes-vs-lewis-official-scorecards-ufc-vegas-19", "https://www.ufc.com/news/ufc-258-official-scorecards-usman-burns-grasso-barber-gastelum-heinisch", "https://www.ufc.com/news/ufc-fight-night-overeem-vs-volkov-official-scorecards-vegas-18", "https://www.ufc.com/news/ufc-257-official-scorecards-poirier-mcgregor-2-fight-island", "https://www.ufc.com/news/ufc-fight-island-8-official-scorecards-magny-chiesa", "https://www.ufc.com/news/ufc-fight-island-7-official-scorecards-holloway-kattar", "https://www.ufc.com/news/ufc-vegas-17-official-vegas-scorecards-Thompson-Neal-Vera-Aldo", "https://www.ufc.com/news/ufc-256-official-judges-scorecards-Figueiredo-Moreno-Ferguson-Oliveira-Holland-Jacare", "https://www.ufc.com/news/ufc-vegas-16-hermansson-vs-vettori-official-scorecards", "https://www.ufc.com/news/ufc-vegas-15-official-judges-scorecards-smith-clark", "https://www.ufc.com/news/ufc-255-official-scorecards-Figueiredo-Perez-Shevchenko-Maia", "https://www.ufc.com/news/ufc-vegas-14-official-scorecards-fight-night-felder-dos-anjos", "https://www.ufc.com/news/ufc-vegas-13-official-scorecards-santos-teixeira", "https://www.ufc.com/news/ufc-fight-night-hall-vs-silva-official-scorecards", "https://www.ufc.com/news/ufc-254-official-scorecards-fight-island-khabib-gaethje", "https://www.ufc.com/news/ufc-fight-island-6-official-scorecards-ortega-korean-zombie-results", "https://www.ufc.com/news/ufc-fight-island-5-official-scorecards-moraes-sandhagen", "https://www.ufc.com/news/fight-night-holm-vs-aldana-official-scorecards-fight-island-4", "https://www.ufc.com/news/ufc-253-official-judges-scorecards-adesanya-costa", "https://www.ufc.com/news/ufc-vegas-11-official-scorecards-covington-woodley", "https://www.ufc.com/news/ufc-vegas-10-official-scorecards-waterson-hill", "https://www.ufc.com/news/ufc-vegas-9-official-scorecards-sakai-overeem", "https://www.ufc.com/news/ufc-vegas-8-official-scorecards-fight-night-smith-rakic"]

    def parse(self, response):
        scorecards_item = ScorecardImagesItem()
        scorecards_item['image_urls'] = response.xpath('//*[@id="block-mainpagecontent"]/div/div[2]/div/div/div[2]/div/div/div[1]/div/div/img/@src').getall()[::-1]
        yield scorecards_item
    